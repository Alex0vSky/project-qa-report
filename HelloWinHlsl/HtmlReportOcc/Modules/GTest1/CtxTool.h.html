<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>CtxTool.h</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
ï»¿// Dx/Ctx/CtxTool.h - structure of helper tools context
#pragma once
// Forward decl
namespace prj_3d::HelloWinHlsl::Dx {
	namespace Tool { namespace Shader { namespace Loader { template&lt;class T&gt; class Composite; } } }
	namespace Tool { namespace Shader { namespace Predef { template&lt;class T&gt; class Composite; } } }
	namespace Tool { template&lt;class TSPE,class T=TSPE&gt; class VertexBuf; }
	namespace Tool { template&lt;class T&gt; class IndexBuf; }
	namespace Tool { namespace Predef { template&lt;class T&gt; class Quad; } }
	namespace Tool { namespace ConstantBuf { namespace viaStruct { template&lt;class T&gt; class FactoryStrict; } } }
	namespace Tool { namespace ConstantBuf { namespace viaStruct { class RootSignatureCreator; } } }
	namespace Tool { namespace Shader { class ConstantSetterDx9; } }
}

namespace prj_3d::HelloWinHlsl::Dx::Ctx { 

// primary template, "typename = void" for partial specialization
// @insp stackoverflow.com/questions/55998031/multiple-conditional-template-specialization-c
template&lt;class T, typename = void&gt; class CtxTool;

namespace detail_ {
template&lt;class T&gt; 
struct CommonToolCtx {
	const sptr&lt; Tool::Shader::Loader::Composite&lt;T&gt; &gt; m_psoShaderLoader;
	uptr&lt; Tool::Shader::Predef::Composite&lt;T&gt; &gt; m_puoShaderPredef;
	const sptr&lt; Tool::VertexBuf&lt;T&gt; &gt; m_psoVertexBuf;
	uptr&lt; Tool::Predef::Quad&lt;T&gt; &gt; m_puoQuad;
	uptr&lt; Tool::ConstantBuf::viaStruct::FactoryStrict&lt;T&gt; &gt; m_puoCBufAccessorFactory;

	typedef uptr&lt; const CtxTool&lt;T&gt; &gt; uptrc_t;
	typedef const uptrc_t &amp;cref_ptr_t;
};

template&lt;class T&gt; 
class CommonMethodsToolCtx : protected detail_::CommonToolCtx&lt;T&gt; {
public:
<span style = "background-color:#fdd">	explicit CommonMethodsToolCtx(CommonToolCtx &amp;&amp;aggregate ) : CommonToolCtx{ std::move( aggregate ) }
	{}</span>
#pragma region methods
	auto shader() const {
		class ChainMe {
			Tool::Shader::Loader::Composite&lt;T&gt; *m_poShaderLoader;
			Tool::Shader::Predef::Composite&lt;T&gt; *m_poShaderPredef;
		public:
			ChainMe(Tool::Shader::Loader::Composite&lt;T&gt; *poShaderLoader
				, Tool::Shader::Predef::Composite&lt;T&gt; *poShaderPredef
			)
				//: m_poShaderLoader( nullptr ) // clang
				//, m_poShaderPredef( nullptr )
			{
				this -&gt;m_poShaderLoader = poShaderLoader;
				this -&gt;m_poShaderPredef = poShaderPredef;
				return;
			}
			auto loader() const {
				return m_poShaderLoader;
			}
			auto predef() const {
				return m_poShaderPredef;
			}
		};
		return std::make_unique&lt; ChainMe &gt;( m_psoShaderLoader.get( ), m_puoShaderPredef.get( ) );
	}
	auto vertexBuf() const {
		return m_psoVertexBuf.get( );
	}
	auto quad() const {
		return m_puoQuad.get( );
	}
#pragma endregion // methods
};

} // namespace detail_ _

// the partial specialization other Dx
template&lt;class T&gt; 
class CtxTool&lt;T&gt; : public detail_::CommonMethodsToolCtx&lt;T&gt; {
public:
	explicit CtxTool(
			CommonToolCtx &amp;&amp;aggregate
		) 
<span style = "background-color:#fdd">		: CommonMethodsToolCtx{ std::move( aggregate ) }
	{}</span>
	auto constBufAccessorFactory() const {
		return CommonMethodsToolCtx::m_puoCBufAccessorFactory.get( );
	}
};
// the full specialization Dx9
template&lt;&gt; class CtxTool&lt;DxVer::v9&gt; : public detail_::CommonMethodsToolCtx&lt;DxVer::v9&gt; { 
	typedef sptr&lt; Tool::Shader::ConstantSetterDx9 &gt; ConstantSetterDx9_t;
	typedef sptr&lt; Tool::IndexBuf&lt;DxVer::v9&gt; &gt; IndexBuf_t;
	ConstantSetterDx9_t m_puoConstantSetterDx9;
	IndexBuf_t m_psoIndexBuf;
public:
	CtxTool(
			CommonToolCtx &amp;&amp;aggregate
			, const ConstantSetterDx9_t &amp;puoConstantSetterDx9
			, const IndexBuf_t &amp;psoIndexBuf
		) 
<span style = "background-color:#fdd">		: CommonMethodsToolCtx{ std::move( aggregate ) }
		, m_puoConstantSetterDx9( puoConstantSetterDx9 )
		, m_psoIndexBuf( psoIndexBuf )
	{}</span>
	auto shaderConstSetterDx9() const {
		return m_puoConstantSetterDx9.get( );
	}
	auto indexBuf() const {
		return m_psoIndexBuf.get( );
	}
};
// the full specialization Dx10
template&lt;&gt; class CtxTool&lt;DxVer::v10&gt; : public detail_::CommonMethodsToolCtx&lt;DxVer::v10&gt; { 
	typedef sptr&lt; Tool::IndexBuf&lt;DxVer::v10&gt; &gt; IndexBuf_t;
	IndexBuf_t m_psoIndexBuf;
public:
	CtxTool(
			CommonToolCtx &amp;&amp;aggregate
			, const IndexBuf_t &amp;psoIndexBuf
		) 
<span style = "background-color:#fdd">		: CommonMethodsToolCtx{ std::move( aggregate ) }
		, m_psoIndexBuf( psoIndexBuf )
	{}</span>
	auto constBufAccessorFactory() const {
		return CommonMethodsToolCtx::m_puoCBufAccessorFactory.get( );
	}
	auto indexBuf() const {
		return m_psoIndexBuf.get( );
	}
};
// the full specialization Dx12
template&lt;&gt; class CtxTool&lt;DxVer::v12&gt; : public detail_::CommonMethodsToolCtx&lt;DxVer::v12&gt; { 
	typedef sptr&lt; Tool::ConstantBuf::viaStruct::RootSignatureCreator &gt; RootSignatureCreator_t;
	RootSignatureCreator_t m_puoRootSignatureCreator;
public:
	CtxTool(
			CommonToolCtx &amp;&amp;aggregate
			, const RootSignatureCreator_t &amp;puoRootSignatureCreator
		) 
<span style = "background-color:#fdd">		: CommonMethodsToolCtx{ std::move( aggregate ) }
		, m_puoRootSignatureCreator( puoRootSignatureCreator )
	{}</span>
	auto constBufAccessorFactory() const {
		return CommonMethodsToolCtx::m_puoCBufAccessorFactory.get( );
	}
	auto constBufRootSignature() const {
		return m_puoRootSignatureCreator.get( );
	}
};

} // namespace prj_3d::HelloWinHlsl::Dx::Ctx</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>