<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>ConstantSetterDx9.h</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
ï»¿// Dx/Tool/Shader/ConstantSetterDx9.h - setter Dx9 shaders constants
#pragma once
namespace prj_3d::HelloWinHlsl::Dx::Tool::Shader {
class ConstantSetterDx9 {
	using TInnerDxVer = DxVer::v9;
	const Ty::StDxCtx_ptr&lt;TInnerDxVer&gt; m_stDxCtx;
public:
	explicit ConstantSetterDx9(Ty::StDxCtx_crefPtr&lt;TInnerDxVer&gt; stDxCtx) 
<span style = "background-color:#fdd">		: m_stDxCtx( stDxCtx ) 
	{}</span>

	class Setter {
		const Ty::StDxCtx_ptr&lt;TInnerDxVer&gt; m_stDxCtx;
		const CPtr&lt; ID3DXConstantTable &gt; m_cpConstantTable;
	public:
		typedef uptr&lt; Setter &gt; uptrc_t;
		Setter(Ty::StDxCtx_crefPtr&lt;TInnerDxVer&gt; stDxCtx, const CPtr&lt;ID3DXConstantTable&gt; &amp;cpConstantTable)
			: m_stDxCtx( stDxCtx )
			, m_cpConstantTable( cpConstantTable )
		{}
		bool setFloat4(const std::string &amp;strNameConst, const D3DXVECTOR4 &amp;value) const {
			// variable can optimized/removed by fxc like "dead code" and get D3DERR_INVALIDCALL
			if ( D3DXHANDLE h = m_cpConstantTable -&gt;GetConstantByName( 0, strNameConst.c_str( ) ) )
				if ( SUCCEEDED( m_cpConstantTable -&gt;SetVector( m_stDxCtx -&gt;m_pcD3dDevice.Get( ), h, &amp;value ) ) ) 
					return true;
			return false;
		}
		bool setMatrix(const std::string &amp;strNameConst, const D3DXMATRIX &amp;value) const {
			if ( D3DXHANDLE h = m_cpConstantTable -&gt;GetConstantByName( 0, strNameConst.c_str( ) ) )
				if ( SUCCEEDED( m_cpConstantTable -&gt;SetMatrix( m_stDxCtx -&gt;m_pcD3dDevice.Get( ), h, &amp;value ) ) ) 
					return true;
			return false;
		}
		bool setFloat(const std::string &amp;strNameConst, float value) const {
			if ( D3DXHANDLE h = m_cpConstantTable -&gt;GetConstantByName( 0, strNameConst.c_str( ) ) )
				if ( SUCCEEDED( m_cpConstantTable -&gt;SetFloat( m_stDxCtx -&gt;m_pcD3dDevice.Get( ), h, value ) ) ) 
					return true;
			return false;
		}
	};

	template&lt;class U&gt;
	typename std::enable_if_t&lt; false
			|| std::is_same_v&lt; U, IDirect3DVertexShader9 &gt;
			|| std::is_same_v&lt; U, IDirect3DPixelShader9 &gt;
		, Setter::uptrc_t &gt;
	create(const CPtr&lt;U&gt; &amp;cp) const {
		UINT uSizeData = 0;
		if ( FAILED( cp -&gt;GetFunction( nullptr, &amp;uSizeData  ) ) ) 
			return nullptr;
		std::vector&lt; char &gt; veMemFunc( (size_t)uSizeData );
		if ( FAILED( cp -&gt;GetFunction( &amp;veMemFunc[ 0 ], &amp;uSizeData ) ) ) 
			return nullptr;
		CPtr&lt; ID3DXConstantTable &gt; cpConstantTable;
		if ( FAILED( ::D3DXGetShaderConstantTable( (DWORD *)&amp;veMemFunc[ 0 ], cpConstantTable.ReleaseAndGetAddressOf( ) ) ) ) 
			return nullptr;
		return std::make_unique&lt; Setter &gt;( m_stDxCtx, cpConstantTable );
	}

};
} // namespace prj_3d::HelloWinHlsl::Dx::Tool::Shader</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>