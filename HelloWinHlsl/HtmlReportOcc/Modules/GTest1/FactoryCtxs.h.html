<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>FactoryCtxs.h</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
ï»¿// Dx/Ctx/FactoryCtxs.h - factory of creating DirectX3D context
#pragma once
namespace prj_3d::HelloWinHlsl::Dx::Ctx {

template&lt;class T&gt; struct CtxFactory; // Fwd decl

namespace detail_ {

template&lt;class T&gt; 
static 
void setWindowTile(
	Sys::Wnd::StToken::cref_t crstWndToken
	, const std::string &amp;strAdapterDescr
<span style = "background-color:#fdd">) {
	Sys::Wnd::Change::title&lt;T&gt;( crstWndToken.m_hWnd, crstWndToken.m_strClientAppName, strAdapterDescr );
}</span>

// From Dx::Ctx::detail_::Common Dx/Ctx/CtxTool.h
template&lt;class T&gt;
static 
<span style = "background-color:#fdd">auto getTupleBaseArgs(Ty::StDxCtx_crefPtr&lt;T&gt; psstDxCtx) {
	auto psoShaderLoader = std::make_shared&lt; Dx::Tool::Shader::Loader::Composite&lt;T&gt; &gt;( psstDxCtx );
	auto psoVertexBuf = std::make_shared&lt; Dx::Tool::VertexBuf&lt;T&gt; &gt;( psstDxCtx );
	return std::make_tuple( </span>
			psoShaderLoader
			, std::make_unique&lt; Dx::Tool::Shader::Predef::Composite&lt;T&gt; &gt;( psstDxCtx, psoShaderLoader )
			, psoVertexBuf
			, std::make_unique&lt; Tool::Predef::Quad&lt;T&gt; &gt;( psstDxCtx, psoVertexBuf )
			, std::make_unique&lt; Tool::ConstantBuf::viaStruct::FactoryStrict&lt;T&gt; &gt;( psstDxCtx )
		);
<span style = "background-color:#fdd">}</span>

template&lt; typename T, typename tup, class... Args1&gt;
static 
<span style = "background-color:#fdd">auto make_uniqueToolCtx(tup&amp;&amp; t, Args1&amp;&amp; ... args1) {
    return std::apply(</span>
        [&amp;args1...] (auto&amp;&amp; ... args2) {
<span style = "background-color:#fdd">			return std::make_unique&lt; const Dx::Ctx::CtxTool&lt; T &gt; &gt;</span>
                (
					CommonToolCtx&lt; T &gt;{ std::forward&lt;decltype(args2)&gt;(args2)... }
					, std::move( args1 )...
				);
<span style = "background-color:#fdd">        },</span>
        std::forward&lt;tup&gt;(t)
    );
<span style = "background-color:#fdd">};</span>

template&lt;class T&gt; 
static 
std::enable_if_t&lt; ( T::m_version == 9 ), Ty::StCtxs_ptr&lt;T&gt; &gt;
<span style = "background-color:#fdd">ctorCtx(Ty::StDxCtx_crefPtr&lt;T&gt; psstDxCtx) {
	auto tupBaseArgs = getTupleBaseArgs&lt; T &gt;( psstDxCtx );</span>

<span style = "background-color:#fdd">	auto puoConstantSetterDx9 = std::make_unique&lt; Dx::Tool::Shader::ConstantSetterDx9 &gt;( psstDxCtx );
	auto psoIndexBuf = std::make_shared&lt; Dx::Tool::IndexBuf&lt;T&gt; &gt;( psstDxCtx );
	auto pustToolCtx = make_uniqueToolCtx&lt; T &gt;</span>
		(
			std::move( tupBaseArgs )
			, std::move( puoConstantSetterDx9 )
			, std::move( psoIndexBuf )
		);

<span style = "background-color:#fdd">	return Dx::Ctxs&lt; T &gt;::z_make_unique( </span>
			std::move( psstDxCtx )
			, std::move( pustToolCtx )
		);
<span style = "background-color:#fdd">}</span>

template&lt;class T&gt; 
static 
std::enable_if_t&lt; ( T::m_version == 10 ), Ty::StCtxs_ptr&lt;T&gt; &gt;
<span style = "background-color:#fdd">ctorCtx(Ty::StDxCtx_crefPtr&lt;T&gt; psstDxCtx) {
	auto tupBaseArgs = getTupleBaseArgs&lt; T &gt;( psstDxCtx );</span>

<span style = "background-color:#fdd">	auto psoIndexBuf = std::make_shared&lt; Dx::Tool::IndexBuf&lt;T&gt; &gt;( psstDxCtx );
	auto pustToolCtx = make_uniqueToolCtx&lt; T &gt;</span>
		(
			std::move( tupBaseArgs )
			, std::move( psoIndexBuf )
		);

<span style = "background-color:#fdd">	return Dx::Ctxs&lt; T &gt;::z_make_unique( </span>
			std::move( psstDxCtx )
			, std::move( pustToolCtx )
		);
<span style = "background-color:#fdd">}</span>

template&lt;class T&gt; 
static 
std::enable_if_t&lt; ( T::m_version == 11 ), Ty::StCtxs_ptr&lt;T&gt; &gt;
<span style = "background-color:#fdd">ctorCtx(Ty::StDxCtx_crefPtr&lt;T&gt; psstDxCtx) {
	auto tupBaseArgs = getTupleBaseArgs&lt; T &gt;( psstDxCtx );</span>

<span style = "background-color:#fdd">	auto pustToolCtx = make_uniqueToolCtx&lt; T &gt;</span>
		(
			std::move( tupBaseArgs )
		);

<span style = "background-color:#fdd">	return Dx::Ctxs&lt; T &gt;::z_make_unique( </span>
			std::move( psstDxCtx )
			, std::move( pustToolCtx )
		);
<span style = "background-color:#fdd">}</span>

template&lt;class T&gt; 
static 
std::enable_if_t&lt; ( T::m_version == 12  ), Ty::StCtxs_ptr&lt;T&gt; &gt;
<span style = "background-color:#fdd">ctorCtx(Ty::StDxCtx_crefPtr&lt;T&gt; psstDxCtx) {
	auto tupBaseArgs = getTupleBaseArgs&lt; T &gt;( psstDxCtx );</span>

<span style = "background-color:#fdd">	auto puoRootSignatureCreator = std::make_unique</span>
		&lt; Dx::Tool::ConstantBuf::viaStruct::RootSignatureCreator &gt;
		( psstDxCtx );
<span style = "background-color:#fdd">	auto pustToolCtx = make_uniqueToolCtx&lt; T &gt; (</span>
			std::move( tupBaseArgs )
			, std::move( puoRootSignatureCreator )
		);

<span style = "background-color:#fdd">	return Dx::Ctxs&lt; T &gt;::z_make_unique( </span>
			std::move( psstDxCtx )
			, std::move( pustToolCtx )
		);
<span style = "background-color:#fdd">}</span>

template&lt;class T,class TAdapter,class TCtxImpl&gt;
struct BaseCtxFactory {
	static 
	Ty::StCtxs_ptr&lt;T&gt;
<span style = "background-color:#fdd">	create(Sys::Wnd::StToken::cref_t crstWndToken) {
		TAdapter oAdapter;
		if ( !oAdapter.prepare( ) ) 
			return nullptr;
		detail_::setWindowTile&lt;T&gt;( crstWndToken, oAdapter.getDescrString( ) );</span>

<span style = "background-color:#fdd">		Ty::StDxCtx_ptr&lt;T&gt; psstDxCtx = </span>
			TCtxImpl::create( crstWndToken, oAdapter );
<span style = "background-color:#fdd">		if ( !psstDxCtx )
			return nullptr;
		return detail_::ctorCtx&lt; T &gt;( psstDxCtx );
	}</span>
};
} // namespace detail_

template&lt;&gt; struct CtxFactory&lt;DxVer::v9&gt;
	: public detail_::BaseCtxFactory&lt;
		DxVer::v9
		, Dx::Adapter::Dx9Adapter
		, Dx::Ctx::Impl::Dx9CtxImpl
	&gt;
{};
template&lt;&gt; struct CtxFactory&lt;DxVer::v10&gt;
	: public detail_::BaseCtxFactory&lt;
		DxVer::v10
		, Dx::Adapter::Dx10Adapter
		, Dx::Ctx::Impl::Dx10CtxImpl
	&gt;
{};
template&lt;&gt; struct CtxFactory&lt;DxVer::v11&gt;
	: public detail_::BaseCtxFactory&lt;
		DxVer::v11
		, Dx::Adapter::Dx11Adapter
		, Dx::Ctx::Impl::Dx11CtxImpl
	&gt;
{};
template&lt;&gt; struct CtxFactory&lt;DxVer::v12&gt;
	: public detail_::BaseCtxFactory&lt;
		DxVer::v12
		, Dx::Adapter::Dx12Adapter
		, Dx::Ctx::Impl::Dx12CtxImpl
	&gt;
{};
} // namespace prj_3d::HelloWinHlsl::Dx::Ctx</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>