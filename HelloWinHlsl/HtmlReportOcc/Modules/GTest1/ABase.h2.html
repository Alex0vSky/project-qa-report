<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>ABase.h</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
ï»¿// GameLoop/ABase.h - base abstract
#pragma once
namespace prj_3d::HelloWinHlsl::GameLoop {
namespace detail_ {

template&lt;class T, class TWndProcHolder&gt;
class ABase {
protected:
	typedef std::mutex mutex_t;
	typedef std::function&lt; void () &gt; pfnCallback_t;

	pfnCallback_t m_pfnCallbackBeforeRender;
<span style = "background-color:#fdd">	void setCallbackBeforeRender(const pfnCallback_t &amp;clb) {
		m_pfnCallbackBeforeRender = clb;
	}</span>
	pfnCallback_t m_pfnCallbackAfterRender;
<span style = "background-color:#fdd">	void setCallbackAfterRender(const pfnCallback_t &amp;clb) {
		m_pfnCallbackAfterRender = clb;
	}</span>
	pfnCallback_t m_pfnCallbackAfterPresent;
<span style = "background-color:#fdd">	void setCallbackAfterPresent(const pfnCallback_t &amp;clb) {
		m_pfnCallbackAfterPresent = clb;
	}</span>

    Ty::StCtxs_ptr&lt;T&gt; m_stCtx;
    typename Ty::CurClientApp&lt;T&gt;::uptr_t m_puoClientApp;
    typename DrawAux::Fps::Ordinary&lt;T&gt;::uptr_t m_puoDrawAuxFps;
    FrameLimiter::ABase::uptr_t m_puoFrameLimiter;

	typename TWndProcHolder::uptr_t m_puoWnd;

	// Allow client to configure auxiliary DirectX features.
	typename Dx::AdjustAux&lt;T&gt;::uptr_t m_puoAdjustDxAux;
	// DynamicData for client, instead all other constant structures
	Ty::DynamicData_ptr&lt;T&gt; m_psoDynamicData;

<span style = "background-color:#fdd">    bool initialize() {
        if ( !m_puoClientApp -&gt;init( m_stCtx -&gt;m_psstDxCtx, m_stCtx -&gt;m_pustToolCtx, m_puoAdjustDxAux.get( ) ) )
			return false;</span>
		// The client has installed the callbacks, now you can complete the setup of the Dx stuff.
<span style = "background-color:#fdd">		m_puoAdjustDxAux -&gt;adjust( );
		return true;
	}</span>

public:
	explicit ABase(
        Ty::StCtxs_ptr&lt;T&gt; pustCtx
        , typename Ty::CurClientApp&lt;T&gt;::uptr_t puoClientApp
        , typename DrawAux::Fps::Ordinary&lt;T&gt;::uptr_t puoDrawAuxFps
        , FrameLimiter::ABase::uptr_t puoFrameLimiter
        , typename TWndProcHolder::uptr_t puoWnd
	) 
<span style = "background-color:#fdd">        : m_stCtx( std::move( pustCtx ) )
        , m_puoClientApp( std::move( puoClientApp ) )
        , m_puoDrawAuxFps( std::move( puoDrawAuxFps ) )
        , m_puoFrameLimiter( std::move( puoFrameLimiter ) )
        , m_puoWnd( std::move( puoWnd ) )
        , m_psoDynamicData( Dx::DynamicData&lt;T&gt;::z_make_shared( ) )
	{}</span>
	virtual ~ABase()
<span style = "background-color:#fdd">	{}</span>
	// Run game loop, not pure("=0") to omit warning C4589 when virtual inher
<span style = "background-color:#fdd">	virtual int run() { 
		return ERROR_CALL_NOT_IMPLEMENTED;
	}</span>
};

// primary template, "typename = void" for partial specialization
template&lt;class T, typename = void&gt; class ABaseWndProcHolderAware;

typedef Dx::Spec::Any::WindowResizerStub DxOther_t;
// the partial specialization other Dx
template&lt;class T&gt; 
class ABaseWndProcHolderAware&lt;T&gt; : public ABase&lt;T, DxOther_t&gt; {
protected:
	using ABase&lt;T, DxOther_t &gt;::ABase;
public:
	virtual ~ABaseWndProcHolderAware() 
<span style = "background-color:#fdd">	{}</span>
};

typedef Dx::Spec::D12::WindowResizer Dx12_t;
// the full specialization Dx12
template&lt;&gt; class ABaseWndProcHolderAware&lt;DxVer::v12&gt; : public ABase&lt;DxVer::v12, Dx12_t&gt; {
protected:
	using ABase&lt; DxVer::v12, Dx12_t &gt;::ABase;
public:
	virtual ~ABaseWndProcHolderAware() 
<span style = "background-color:#fdd">	{}</span>
};
} // namespace detail_;

template&lt;class T&gt; using ABase_t = detail_::ABaseWndProcHolderAware&lt;T&gt;;
} // namespace prj_3d::HelloWinHlsl::GameLoop</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>