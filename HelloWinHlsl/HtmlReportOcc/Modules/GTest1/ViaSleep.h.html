<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>ViaSleep.h</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
ï»¿// FrameLimiter/ViaSleep.h - fps limiter based on thread slip.
// @insp stackoverflow.com/questions/38730273/how-to-limit-fps-in-a-loop-with-c
// They say that turning on vertical sync gives a limit of 60 frames per second -- 
// www.gamedev.net/forums/topic/705049-60fps-framelock-done-properly-without-duplicated-or-skipped-frames/5418316/
#pragma once
namespace prj_3d::HelloWinHlsl::FrameLimiter {
class ViaSleep : public ABase { 
    using ChrDurMeasure_t = std::chrono::system_clock::duration;

    std::chrono::system_clock::time_point m_chrdNextFrame;
	ChrDurMeasure_t m_chrdFrameStep;
public:
    explicit ViaSleep(unsigned int uFreq_Hz)
<span style = "background-color:#fdd">        : m_chrdNextFrame( std::chrono::system_clock::now( ) )
    {
		auto chrdMilliInSec = std::chrono::duration_cast&lt; std::chrono::milliseconds &gt;( std::chrono::seconds( 1 ) );
		auto chrdMilliInFreq = std::chrono::milliseconds( chrdMilliInSec / std::chrono::milliseconds( uFreq_Hz ) );
		m_chrdFrameStep = std::chrono::duration_cast&lt; ChrDurMeasure_t &gt;( chrdMilliInFreq );
    }</span>
	// TODO: remakeme, wrong when hung in start
<span style = "background-color:#fdd">    void limit() override {</span>
        // TODO: calc time spend before current method call, and then reduce next frame step
<span style = "background-color:#fdd">        std::this_thread::sleep_until( m_chrdNextFrame );
        m_chrdNextFrame += m_chrdFrameStep;
    }</span>
};
} // namespace prj_3d::HelloWinHlsl::FrameLimiter</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>