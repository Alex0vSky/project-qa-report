<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>Menu.h</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
// src\Menu.h - menu, create and process window messages
#pragma once // Copyright 2023 Alex0vSky (https://github.com/Alex0vSky)
namespace prj_sysw { namespace TinySynapticsScroll {
template&lt;class T = DialogPopupSettings&lt; &gt;&gt;
class Menu {
	// functon "IsDialogMessage()" uses "WM_USER" and "WM_USER + 1" id's
	static const UINT c_uMessageId = WM_USER + 2;
	T *m_poDialog;

<span style = "background-color:#dfd">	bool create_(HWND hWnd) const {</span>
		// @insp https://learn.microsoft.com/en-us/windows/win32/menurc/using-menus#using-menu-item-bitmaps
		POINT lpClickPoint;
		HMENU hMenu, hSubMenu;
		// get mouse cursor position x and y as lParam has the uMsg itself
<span style = "background-color:#dfd">		::GetCursorPos( &amp;lpClickPoint );</span>

<span style = "background-color:#dfd">		hMenu = ::CreateMenu( );
		hSubMenu = ::CreatePopupMenu( );
		::AppendMenuA( hMenu, MF_POPUP, (UINT_PTR)hSubMenu, "" );
		::AppendMenuA( hSubMenu, MF_STRING, (UINT_PTR)EnuIdPopup::Settings, "Settings" );
		::AppendMenuA( hSubMenu, MF_SEPARATOR, (UINT_PTR)-1, "" );
		::AppendMenuA( hSubMenu, MF_STRING, (UINT_PTR)EnuIdPopup::Exit, "Stop and unload" ); // MFS_DEFAULT = bold</span>

		// Make bold font of last item
<span style = "background-color:#dfd">		MENUITEMINFOA stMii = { };
		stMii.cbSize = sizeof( stMii );
		stMii.fMask = MIIM_STATE;
		::GetMenuItemInfoA( hSubMenu, (UINT)GetMenuItemCount( hSubMenu ) - 1, TRUE, &amp;stMii );
		stMii.fState |= MFS_DEFAULT;
		::SetMenuItemInfoA( hSubMenu, (UINT)GetMenuItemCount( hSubMenu ) - 1, TRUE, &amp;stMii );</span>

		// Display menu
<span style = "background-color:#dfd">		::SetForegroundWindow( hWnd );
		::TrackPopupMenu( </span>
				hSubMenu
				, TPM_LEFTALIGN | TPM_LEFTBUTTON | TPM_BOTTOMALIGN
				, lpClickPoint.x, lpClickPoint.y, 0, hWnd, NULL 
			);
<span style = "background-color:#dfd">		::SendMessageA( hWnd, WM_NULL, 0, 0 );</span>

<span style = "background-color:#dfd">		::DestroyMenu( hSubMenu );
		::DestroyMenu( hMenu );
		return true;
	}</span>
	
 protected:
	enum struct EnuIdPopup : WORD {
		Exit,
		Settings,
	};
	
 public:
	Menu(const Menu &amp;) = delete;
	explicit Menu(T *poDialog)
<span style = "background-color:#dfd">		: m_poDialog( poDialog )
    {}
	bool handleWindowMessage(HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam) const {
		if ( c_uMessageId == uMsg &amp;&amp; WM_RBUTTONDOWN == LOWORD( lParam ) ) {
			if ( create_( hWnd ) )
				return true;</span>
		}
		// Restore dialog by double click
<span style = "background-color:#dfd">		if ( c_uMessageId == uMsg &amp;&amp; WM_LBUTTONDBLCLK == LOWORD( lParam ) ) {
			if ( m_poDialog -&gt;getHandle( ) ) 
				::SetForegroundWindow( hWnd );
			return true;</span>
		}
		// Ctx menu action
<span style = "background-color:#dfd">		if ( WM_COMMAND == uMsg ) {
			switch( EnuIdPopup( LOWORD( wParam ) ) ) {</span>
				case EnuIdPopup::Settings:
<span style = "background-color:#dfd">					m_poDialog -&gt;create( hWnd );
					return true;</span>
				break; // @NOCOVERAGE
				case EnuIdPopup::Exit:
<span style = "background-color:#dfd">					::DestroyWindow( hWnd );
					return true;</span>
				break;
			}
		}
<span style = "background-color:#dfd">		return false;
	}
	static DWORD getWindowMessageId() {
		return c_uMessageId;
	}</span>
};
}} // namespace prj_sysw::TinySynapticsScroll _</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>