<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>Registry.h</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
// src\Registry.h - minor registry operations
#pragma once // Copyright 2023 Alex0vSky (https://github.com/Alex0vSky)
namespace prj_3d { namespace UePrjCreator {
namespace detail_ {
class BaseReg {
protected:
	static const REGSAM m_Desired = KEY_READ;
	static const DWORD m_Options = REG_OPTION_NON_VOLATILE; // default
	const HKEY m_hKey;
	struct Buffer {
		static const int c_Chars = MAX_PATH;
		mutable wchar_t m_Data[ c_Chars + 1 ];
		static const int c_Bytes = c_Chars * sizeof( m_Data[ 0 ] );
	} m_buf;
<span style = "background-color:#fdd">	explicit BaseReg(HKEY hKey) : m_hKey( hKey ), m_buf{}
    {}</span>
public:
	BaseReg &amp;operator = (const BaseReg &amp;) = delete;
};
} // namespace detail_

class Reg : public detail_::BaseReg {
	using detail_::BaseReg::BaseReg;

	class RegEnum : public detail_::BaseReg {
		using detail_::BaseReg::BaseReg;

	public:
<span style = "background-color:#fdd">		auto all() const {
			std::map&lt; std::wstring, const Reg &gt; Return;
			DWORD i = 0;</span>
			LSTATUS lst;
<span style = "background-color:#fdd">			while ( ERROR_SUCCESS == ( lst = </span>
				::RegEnumKeyW( m_hKey, i++, m_buf.m_Data, m_buf.c_Chars ) 
			) ) { 
<span style = "background-color:#fdd">				HKEY hKey = 0;
				LSTATUS lstOpen = ::RegOpenKeyExW( </span>
					m_hKey, m_buf.m_Data, m_Options, m_Desired, &amp;hKey );
<span style = "background-color:#fdd">				if ( ERROR_SUCCESS != lstOpen ) 
					continue;
				std::pair&lt; const std::wstring, const Reg &gt; var( </span>
					m_buf.m_Data, Reg( hKey ) );
<span style = "background-color:#fdd">				Return.insert( var );
			}
			if ( ERROR_NO_MORE_ITEMS != lst ) 
				::SetLastError( lst );
			return Return;
		}</span>
		friend class Reg;
	};

public:
<span style = "background-color:#fdd">	bool readString(const wchar_t *ValueName, std::wstring &amp;ValueValue) const { 
		DWORD Type = REG_SZ;
		DWORD cbData = m_buf.c_Bytes;
		LSTATUS lst = ::RegQueryValueExW( </span>
			m_hKey, ValueName, nullptr, &amp;Type, reinterpret_cast&lt; LPBYTE &gt;( m_buf.m_Data ), &amp;cbData );
<span style = "background-color:#fdd">		if ( ERROR_SUCCESS != lst )
			return false;</span>
		// is NOT guaranteed to be null-terminated.
<span style = "background-color:#fdd">		DWORD CountChars = ( cbData - 1 ) / sizeof( m_buf.m_Data[ 0 ] );
		ValueValue = std::wstring( m_buf.m_Data, CountChars );
		return true;
	}</span>
	
<span style = "background-color:#fdd">	static std::optional&lt; RegEnum &gt; createEnumerate(const wchar_t *wcsKey) {
		HKEY hKey = 0;
		LSTATUS lstOpen = ::RegOpenKeyExW( </span>
			HKEY_LOCAL_MACHINE, wcsKey, m_Options, m_Desired, &amp;hKey );
<span style = "background-color:#fdd">		if ( ERROR_SUCCESS != lstOpen ) 
			return {};
		return RegEnum( hKey );
	}</span>
};
}} // namespace prj_3d::UePrjCreator</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>