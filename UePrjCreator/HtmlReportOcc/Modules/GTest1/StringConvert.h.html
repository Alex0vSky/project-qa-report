<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>StringConvert.h</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
// src\StringConvert.h - string conversion: wchar_t to char; char to wchar_t;
#pragma once // Copyright 2023 Alex0vSky (https://github.com/Alex0vSky)
namespace prj_3d { namespace UePrjCreator {
struct StringConvert {
	class ArgvChar { 
		std::unique_ptr&lt; const char ** &gt; m_argvPtrs;
		const char **m_argv;
		std::vector&lt; std::string &gt; m_stringStorage;
	public:
		ArgvChar(int argc, wchar_t *argv[]) 
<span style = "background-color:#fdd">			: m_argvPtrs( std::make_unique&lt; const char **&gt;( new const char *[ argc ] ) )
		{
			m_argv = *m_argvPtrs;
			for ( int i = 0; i &lt; argc; ++i ) {
				m_stringStorage.push_back( StringConvert::wcsrtombs( argv[ i ] ) );
				m_argv[ i ] = m_stringStorage.back( ).c_str( );
			}
		}
		int argc() {
			return (int)m_stringStorage.size( );
		}
		auto argv() {
			return m_argv;
		}</span>
	};
<span style = "background-color:#fdd">	static const char *getLocaleOption() {</span>
		static const char *sz = "en_US.utf8";
<span style = "background-color:#fdd">		return sz;
	}</span>

	// TODO: do it like template
<span style = "background-color:#fdd">	static std::string wcsrtombs(const std::wstring &amp;wcstr) {</span>
		static bool bLocale = false;
<span style = "background-color:#fdd">		if ( !bLocale ) {
			std::setlocale( LC_ALL, getLocaleOption( ) );
			bLocale = true;</span>
		}
		size_t len;
<span style = "background-color:#fdd">		const wchar_t *wstr = wcstr.c_str( );
		wcsrtombs_s( &amp;len, nullptr, 0, &amp;wstr, 0, nullptr );
		if ( len == static_cast&lt; std::size_t &gt;( -1 ) ) 
			throw std::logic_error( "Illegal byte sequence" );
		std::vector&lt; char &gt; plainMemory( len );
		wcsrtombs_s( nullptr, plainMemory.data( ), len, &amp;wstr, len, nullptr );
		std::string mbstr( plainMemory.data( ), len - 1 );
		return mbstr;
	}
	static std::wstring mbsrtowcs(const std::string &amp;mbstr) {</span>
		static bool bLocale = false;
<span style = "background-color:#fdd">		if ( !bLocale ) {
			std::setlocale( LC_ALL, getLocaleOption( ) );
			bLocale = true;</span>
		}
		size_t len;
<span style = "background-color:#fdd">		const char *str = mbstr.c_str( );
		mbsrtowcs_s( &amp;len, nullptr, 0, &amp;str, 0, nullptr );
		if ( len == static_cast&lt; std::size_t &gt;( -1 ) ) 
			throw std::logic_error( "Illegal byte sequence" );
		std::vector&lt; wchar_t &gt; plainMemory( len );
		mbsrtowcs_s( nullptr, plainMemory.data( ), len, &amp;str, len, nullptr );
		std::wstring wcstr( plainMemory.data( ), len - 1 );
		return wcstr;
	}</span>
};
}} // namespace prj_3d::UePrjCreator</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>