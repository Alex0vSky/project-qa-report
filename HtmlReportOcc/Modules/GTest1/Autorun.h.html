<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
        <meta charset="utf-8"/>
	    <title>Autorun.h</title>
	    <link href="../../third-party/google-code-prettify/prettify-CppCoverage.css" type="text/css" rel="stylesheet" />
	    <script type="text/javascript" src="../../third-party/google-code-prettify/prettify.js"></script>
	</head>
    <body onload="prettyPrint()">
        <h4></h4>
        <pre class="prettyprint lang-cpp linenums">
// src\PersistSettings\Autorun.h - place current touchPad autoruns setup to ui, store value in registry
#pragma once // Copyright 2023 Alex0vSky (https://github.com/Alex0vSky)
namespace prj_sysw { namespace TinySynapticsScroll { namespace PersistSettings { 
template&lt;class T = Tool::Registry&gt;
class Autorun {
	HWND m_hWndDialog;
	size_t m_siCurrentFfnLen;
	const int m_nIDButton;
	wchar_t m_wcsFfnCur[ MAX_PATH + 1 ];
<span style = "background-color:#dfd">	bool check_() const {
		return 0 != ::CheckDlgButton( m_hWndDialog, m_nIDButton, BST_CHECKED );
	}</span>
	
 protected:
	const T m_oReg;
	
 public:
	explicit Autorun(int nIDButton )
<span style = "background-color:#dfd">		: m_hWndDialog( nullptr )
		, m_siCurrentFfnLen( 0 )
		, m_nIDButton( nIDButton )
		, m_wcsFfnCur{ }
		, m_oReg( </span>
			T::openAlways( 
				Config::Autorun::s_enuRootKey
				, Config::Autorun::getRegSubkey( )
				, Tool::Registry::EnuDesiredAccessRights::ALL_ACCESS 
				) 
			)
<span style = "background-color:#dfd">    {}
	bool initAndLoadToUi(HWND hWndDialog) { 
		m_hWndDialog = hWndDialog;</span>
		// GetModuleHandleA not increments the module's reference count
<span style = "background-color:#dfd">		HMODULE hInst = ::GetModuleHandleA( NULL );
		m_siCurrentFfnLen = static_cast&lt;size_t&gt;( ::GetModuleFileNameW( hInst, m_wcsFfnCur, MAX_PATH ) );
		if ( 0 == m_siCurrentFfnLen || MAX_PATH == m_siCurrentFfnLen )
			return false;
		Tool::HeapMem oBufAutorun;</span>
		size_t siRegFfnLen;
<span style = "background-color:#dfd">		if ( !m_oReg.readString( Config::Autorun::getRegValueName( ), &amp;oBufAutorun, &amp;siRegFfnLen ) )
			return true;</span>

		// compare strings
<span style = "background-color:#dfd">		if ( siRegFfnLen != m_siCurrentFfnLen ) 
			return true;</span>
		size_t i;
<span style = "background-color:#dfd">		const wchar_t *wcsRegFfn = static_cast&lt;wchar_t *&gt;( oBufAutorun.getMemPtr( ) );
		for ( i = 0; i &lt; siRegFfnLen; ++i ) 
			if ( m_wcsFfnCur[ i ] != wcsRegFfn[ i ] )
				break;
		if ( i == siRegFfnLen ) 
			if ( !check_( ) )
				return false;</span>

<span style = "background-color:#dfd">		return true;
	}
	bool saveToAutorun() const {
		if ( m_oReg.createAndSetValueString( Config::Autorun::getRegValueName( ), m_wcsFfnCur ) ) 
			return true;
		::CheckDlgButton( m_hWndDialog, m_nIDButton, BST_UNCHECKED );
		return false;
	}
	bool removeFromAutorun() const {
		if ( m_oReg.deleteValue( Config::Autorun::getRegValueName( ) ) ) 
			return true;
		check_( );
		return false;
	}</span>

	Autorun &amp;operator = (const Autorun &amp;) = delete;
	Autorun(const Autorun &amp;) = delete;
};
}}} // namespace prj_sysw::TinySynapticsScroll::PersistSettings _</pre>
        <hr />
        <table width="100%">
            <thead>
                <tr>
                    <th align="center">
                        <small>Generated by</small>
                        <a href="https://github.com/OpenCppCoverage/OpenCppCoverage/releases">
                            <strong>OpenCppCoverage (Version: 0.9.9.0)</strong>
                        </a>
                    </th>
                </tr>
            </thead>
        </table>
    </body>
</html>